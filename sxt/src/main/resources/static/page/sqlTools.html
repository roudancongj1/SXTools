<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SQT</title>
    <script src="../js/axios.js"></script>
    <style>
        #progress {
            min-width: 100%;
            height: 40px;
            background-color: #ddd;
            border-radius: 10px;
        }
        #bar {
            height: 100%;
            background-color: #4CAF50;
            width: 0;
            border-radius: 10px;
        }
        a:visited {
            color: dimgray
        }
    </style>
</head>
<body>
<button onclick="executeAll()">execute all</button>
<div>
    <a id="a1" href="#" onclick="testSend('a1','loading1','ok1','err1')" style="color: cornflowerblue">团险导数据</a>
    <img id="loading1" style="display: none" src="/img/loading.gif">
    <img id="ok1" style="display: none" src="/img/ok.svg">
    <img id="err1" style="display: none" src="/img/err.svg">
</div>
<div id="progress">
    <div id="bar"></div>
</div>

<script>



    let executeAll = async () => {
        const threadNum = 3
        const addNum = Math.floor(10000/threadNum)/100
        let currentProgress = 0.00
        progressBar(currentProgress)
        if (await testSend('loading1','ok1','err1')){
            currentProgress += addNum
            progressBar(currentProgress)
            if (await testSend('loading1','ok1','err1')){
                currentProgress += addNum
                progressBar(currentProgress)
            }
        }

    }
    let testSend = async (aId,lId, oId, eId) => {
        let progress = false
        unaShow(aId)
        show(lId)
        unShow(oId)
        unShow(eId)
        await axios({
            method: 'get',
            url: 'LFBusiness',
        }).then((req) => {
            unShow(lId)
            if (req.data.code === '0') {
                show(oId)
                progress = true
            } else {
                show(eId)
                progress = false
            }
        }).catch(err => {
            unShow(lId)
            show(eId)
            alert(err)
        })
        return progress
    }


    let show = (id) => {
        //document.getElementById("loading1").getAttributeNode("style").value = "visibility: visible/hidden"
        document.getElementById(id).getAttributeNode("style").value = "display: inline"
    }

    let unShow = (id) => {
        //document.getElementById("loading1").getAttributeNode("style").value = "visibility: visible/hidden"
        document.getElementById(id).getAttributeNode("style").value = "display: none"
    }

    let unaShow = (id) => {
        document.getElementById(id).getAttributeNode("style").value = "pointer-events: none"
    }

    let progressBar = (percent) => {
        const bar = document.getElementById("bar");
        bar.style.width = `${percent}%`;
    }
</script>
</body>
</html>